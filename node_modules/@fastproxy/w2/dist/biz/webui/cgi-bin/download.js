"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const safe_buffer_1 = require("safe-buffer");
const util = tslib_1.__importStar(require("./util"));
function default_1(req, res) {
    const body = req.body;
    let filename = body.filename;
    let headers = body.headers;
    let content = body.content;
    let type = body.type;
    let suffix = '.txt';
    if (type === 'log') {
        suffix = '.log';
    }
    else if (type === 'rawBase64') {
        type = 'base64';
        suffix = '';
    }
    if (!filename || typeof filename !== 'string') {
        filename = 'text_' + util.formatDate() + suffix;
    }
    else if (!/\.\w+$/.test(filename)) {
        filename += suffix;
    }
    if (type === 'base64') {
        try {
            content = safe_buffer_1.Buffer.from(content, 'base64');
        }
        catch (e) { }
    }
    if (headers) {
        headers += '\r\n\r\n';
        try {
            headers = safe_buffer_1.Buffer.from(headers);
            if (safe_buffer_1.Buffer.isBuffer(content)) {
                content = safe_buffer_1.Buffer.concat([headers, content]);
                headers = null;
            }
        }
        catch (e) { }
        if (headers) {
            content = headers + (content || '');
        }
    }
    res.attachment(filename).send(content);
}
exports.default = default_1;
