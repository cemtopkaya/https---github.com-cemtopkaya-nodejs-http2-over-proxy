"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const ca = tslib_1.__importStar(require("../../../lib/https/ca"));
const URL_RE = /^(?:(?:[\w.-]+:)?\/\/)?([\w.-]+)/i;
function parseDomain(domain) {
    domain = domain && typeof domain === 'string' && domain.trim();
    if (!domain || domain.length > 64 || !URL_RE.test(domain)) {
        return;
    }
    return RegExp.$1;
}
function default_1(req, res) {
    const domain = parseDomain(req.query.domain);
    if (!domain) {
        return res.status(400).end('Bad Request');
    }
    if (domain === 'rootCA') {
        return res.json(ca.getRootCA());
    }
    res.json(ca.createCertificate(domain.toLowerCase()));
}
exports.default = default_1;
