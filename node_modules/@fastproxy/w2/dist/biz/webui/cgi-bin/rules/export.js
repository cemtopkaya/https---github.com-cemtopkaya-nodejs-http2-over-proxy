"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const util_1 = require("../../../../lib/rules/util");
const util = tslib_1.__importStar(require("../util"));
function default_1(req, res) {
    let exportRules = req.query.rules;
    try {
        exportRules = exportRules && JSON.parse(exportRules);
    }
    catch (e) {
        exportRules = null;
    }
    const result = {};
    if (!exportRules || exportRules.Default) {
        const defaultRules = util_1.rules.getDefault() || '';
        result.Default = defaultRules;
    }
    util_1.rules.list().forEach(function (file) {
        if (!exportRules || exportRules[file.name]) {
            result[file.name] = file.data;
        }
    });
    let filename = req.query.filename;
    if (filename && typeof filename === 'string') {
        if (!/\.(txt|json)/i.test(filename)) {
            filename += '.txt';
        }
    }
    else {
        filename = 'rules_' + util.formatDate() + '.txt';
    }
    res.attachment(filename).send(JSON.stringify(result, null, '  '));
}
exports.default = default_1;
