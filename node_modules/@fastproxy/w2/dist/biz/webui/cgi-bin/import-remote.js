"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const util = tslib_1.__importStar(require("../../../lib/util"));
const MAX_LEN = 1024 * 1024 * 6;
const HTTP_RE = /https?:\/\//i;
function default_1(req, res) {
    const url = req.query.url;
    if (HTTP_RE.test(url)) {
        util.request({
            url: url,
            maxLength: MAX_LEN
        }, function (err, body, r) {
            if (err) {
                const msg = err.code === 'EEXCEED'
                    ? 'The size of response body exceeds 6m'
                    : err.message;
                return res.json({ ec: 2, em: msg });
            }
            const status = r.statusCode;
            if (status !== 200) {
                const em = status > 200 && status < 400 ? 'No body data' : 'Request failed';
                return res.json({ ec: 2, em: em + ' (statusCode: ' + status + ')' });
            }
            return res.json({ ec: 0, body: body });
        });
    }
    else {
        res.json({ ec: 400, em: 'Bad url' });
    }
}
exports.default = default_1;
