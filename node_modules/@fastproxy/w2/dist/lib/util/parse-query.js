"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const querystring_1 = tslib_1.__importDefault(require("querystring"));
const TOKEN_RE = /\r\u0000\n\u0003\r/g;
const PLUS_RE = /\+/g;
const TOKEN = '\r\u0000\n\u0003\r';
const decoder = {
    decodeURIComponent: function (s) {
        s = s.replace(TOKEN_RE, '+');
        return querystring_1.default.unescape(s);
    }
};
const rawDecoder = {
    decodeURIComponent: function (s) {
        return s.replace(TOKEN_RE, '+');
    }
};
const rawDecoder2 = {
    decodeURIComponent: function (s) {
        return s;
    }
};
function parse(str, sep, eq, escape) {
    try {
        if (str.indexOf('+') === -1 || str.indexOf(TOKEN) !== -1) {
            return querystring_1.default.parse(str, sep, eq, escape ? rawDecoder2 : undefined);
        }
        str = str.replace(PLUS_RE, TOKEN);
        return querystring_1.default.parse(str, sep, eq, escape ? rawDecoder : decoder);
    }
    catch (e) { }
    return '';
}
exports.default = parse;
