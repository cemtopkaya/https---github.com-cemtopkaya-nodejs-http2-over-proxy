import { describe, expect, test } from 'vitest';
import { request } from '../../../__tests__/utils';
describe('params', () => {
    test('ok', async () => {
        const r1 = await request({
            url: 'http://params.test.whistlejs.com/index.html',
            method: 'POST',
            form: { key: 'value' }
        });
        expect(r1.data.body).toBe('key=value&test=abc');
        const r2 = await request({
            url: 'http://params.test.whistlejs.com/index.html',
            method: 'POST',
            headers: {
                'content-type': 'application/json'
            },
            body: JSON.stringify({ key: 'value' })
        });
        expect(r2.data.body).toContain('"test":"abc"');
        expect(r2.data.resMerge).toBe('test');
        const r3 = await request({
            url: 'http://upload.test.whistlejs.com/index.html',
            method: 'post',
            formData: {
                name1: 'my_value',
                file1: {
                    value: 'ok',
                    options: {
                        filename: 'topsecret.jpg',
                        contentType: 'text/plain'
                    }
                }
            }
        });
        expect(r3.data.body).toContain('filename=""');
        expect(r3.data.body).toContain('name="name2"');
        expect(r3.data.body).toContain('name="file2"');
        expect(r3.data.body).toContain('filename="text.txt"');
        expect(r3.data.body).toContain('1234567890');
        const r4 = await request('http://params2.test.whistlejs.com/index.html?name=aven');
        expect(r4.data.url).toContain('?name=aven&test=abc');
    });
});
