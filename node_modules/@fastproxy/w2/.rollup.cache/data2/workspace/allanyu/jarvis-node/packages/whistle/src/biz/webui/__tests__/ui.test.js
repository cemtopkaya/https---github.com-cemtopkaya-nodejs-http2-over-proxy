import { expect, test } from 'vitest';
import { request } from '../../../__tests__/utils';
test('ui', async () => {
    await Promise.all([
        request('https://local.whistlejs.com/favicon.ico?doNotParseJson'),
        request('https://local.whistlejs.com/?doNotParseJson'),
        request('http://rd2webui.w2.org/index.html?doNotParseJson'),
        request('http://rd2webui.w2.org/?doNotParseJson'),
        request('http://local.whistlejs.com/index.html?doNotParseJson'),
        request('http://local.whistlejs.com/?doNotParseJson'),
        request('http://local.whistlejs.com:1234/index.html?doNotParseJson'),
        request('http://local.whistlejs.com/cgi-bin/log/get'),
        request('http://local.whistlejs.com/cgi-bin/init'),
        request('http://local.whistlejs.com:2345/cgi-bin/init'),
        request('http://local.whistlejs.com/cgi-bin/get-data'),
        request('http://local.whistlejs.com/cgi-bin/server-info'),
        request('http://local.whistlejs.com/cgi-bin/values/list'),
        request('http://local.whistlejs.com/cgi-bin/plugins/get-plugins'),
        request('http://local.whistlejs.com/cgi-bin/rules/list'),
        request('http://local.whistlejs.com/cgi-bin/rootca')
    ]);
    const r1 = await request('http://local.whistlejs.com/cgi-bin/root?doNotParseJson');
    expect(r1.res.statusCode).toBe(404);
    await request('https://local.whistlejs.com/index.html?doNotParseJson');
    await request('https://local.whistlejs.com:1234/index.html?doNotParseJson');
    await request('https://local.whistlejs.com/cgi-bin/log/get');
    await request('https://local.whistlejs.com/cgi-bin/init');
    await request('https://local.whistlejs.com:2345/cgi-bin/init');
    await request('https://local.whistlejs.com/cgi-bin/get-data');
    await request('https://local.whistlejs.com/cgi-bin/server-info');
    await request('https://local.whistlejs.com/cgi-bin/values/list');
    await request('https://local.whistlejs.com/cgi-bin/plugins/get-plugins');
    await request('https://local.whistlejs.com/cgi-bin/rules/list');
    await request('https://local.whistlejs.com/whistle.test');
    await request('http://local.whistlejs.com/whistle.test');
    await request('https://local.whistlejs.com/plugin.test');
    await request('http://local.whistlejs.com/plugin.test');
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/log/get',
        headers: {
            origin: 'http://wproxy.org'
        }
    });
    // 串行
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/values/add',
        method: 'post',
        form: {
            name: 'test',
            value: '123'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/values/rename',
        method: 'post',
        form: {
            name: 'test',
            newName: '123'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/values/remove',
        method: 'post',
        form: {
            name: '123'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/values/move-to',
        method: 'post',
        form: {
            to: 'test',
            from: 'abc'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/add',
        method: 'post',
        form: {
            name: 'test',
            value: '/test/ file://xxx'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/enable-default',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/remove',
        method: 'post',
        form: {
            name: 'test',
            value: '/test/ file://xxx'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/rename',
        method: 'post',
        form: {
            name: 'test',
            newName: 'sssss'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/select',
        method: 'post',
        form: {
            name: 'test'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/unselect',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/allow-multiple-choice',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/log/set',
        method: 'get',
        form: {
            level: 'error',
            text: 'teset error log'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/composer',
        method: 'post',
        form: {
            url: 'http://test.whistlejs.com/'
        }
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/intercept-https-connects',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/hide-https-connects',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/do-not-show-again',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/check-update',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/move-to',
        method: 'post'
    });
    await request({
        url: 'http://local.whistlejs.com/cgi-bin/rules/get-sys-hosts',
        method: 'post'
    });
    await request('http://local.wproxy.org:1234/index.html?doNotParseJson');
    await request('http://local.wproxy.org:1234/index.html?doNotParseJson');
    await request('http://local.wproxy.org:1234/cgi-bin/log/get');
    await request('http://local.wproxy.org:1234/cgi-bin/init');
    await request('http://local.wproxy.org:1234/cgi-bin/get-data');
    await request('http://local.wproxy.org:1234/cgi-bin/server-info');
    await request('http://local.wproxy.org:1234/cgi-bin/values/list');
    await request('http://local.wproxy.org:1234/cgi-bin/plugins/get-plugins');
    await request('http://local.wproxy.org:1234/cgi-bin/rules/list');
    await request('https://local.wproxy.org:1234/index.html?doNotParseJson');
    await request('https://local.wproxy.org:1234/index.html?doNotParseJson');
    await request('https://local.wproxy.org:1234/cgi-bin/log/get');
    await request('https://local.wproxy.org:1234/cgi-bin/init');
    await request('https://local.wproxy.org:1234/cgi-bin/get-data');
    await request('https://local.wproxy.org:1234/cgi-bin/server-info');
    await request('https://local.wproxy.org:1234/cgi-bin/values/list');
    await request('https://local.wproxy.org:1234/cgi-bin/plugins/get-plugins');
    await request('https://local.wproxy.org:1234/cgi-bin/rules/list');
    await request('https://local.wproxy.org:1234/whistle.test');
    await request('http://local.wproxy.org:1234/whistle.test');
    await request('https://local.wproxy.org:1234/plugin.test');
    await request('http://local.wproxy.org:1234/plugin.test');
    // 如下3个串行
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/values/add',
        method: 'post',
        form: {
            name: 'test',
            value: '123'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/values/rename',
        method: 'post',
        form: {
            name: 'test',
            newName: '123'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/values/remove',
        method: 'post',
        form: {
            name: '123'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/values/move-to',
        method: 'post',
        form: {
            to: 'test',
            from: 'abc'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/add',
        method: 'post',
        form: {
            name: 'test',
            value: '/test/ file://xxx'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/enable-default',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/remove',
        method: 'post',
        form: {
            name: 'test',
            value: '/test/ file://xxx'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/rename',
        method: 'post',
        form: {
            name: 'test',
            newName: 'sssss'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/select',
        method: 'post',
        form: {
            name: 'test'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/unselect',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/allow-multiple-choice',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/log/set',
        method: 'get',
        form: {
            level: 'warn',
            text: 'teset warn log'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/composer',
        method: 'post',
        form: {
            url: 'http://test.whistlejs.com/'
        }
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/intercept-https-connects',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/hide-https-connects',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/do-not-show-again',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/check-update',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/move-to',
        method: 'post'
    });
    await request({
        url: 'http://local.wproxy.org:1234/cgi-bin/rules/get-sys-hosts',
        method: 'post'
    });
    await request('http://local.whistle.com/index.html?doNotParseJson');
    await request('http://local.whistle.com:1234/index.html?doNotParseJson');
    await request('http://local.whistle.com/cgi-bin/log/get');
    await request('http://local.whistle.com/cgi-bin/init');
    await request('http://local.whistle.com:2345/cgi-bin/init');
    await request('http://local.whistle.com/cgi-bin/get-data');
    await request('http://local.whistle.com/cgi-bin/server-info');
    await request('http://local.whistle.com/cgi-bin/values/list');
    await request('http://local.whistle.com/cgi-bin/plugins/get-plugins');
    await request('http://local.whistle.com/cgi-bin/rules/list');
    await request('https://local.whistle.com/index.html?doNotParseJson');
    await request('https://local.whistle.com:1234/index.html?doNotParseJson');
    await request('https://local.whistle.com/cgi-bin/log/get');
    await request('https://local.whistle.com/cgi-bin/init');
    await request('https://local.whistle.com:2345/cgi-bin/init');
    await request('https://local.whistle.com/cgi-bin/get-data');
    await request('https://local.whistle.com/cgi-bin/server-info');
    await request('https://local.whistle.com/cgi-bin/values/list');
    await request('https://local.whistle.com/cgi-bin/plugins/get-plugins');
    await request('https://local.whistle.com/cgi-bin/rules/list');
    await request('https://local.whistle.com/whistle.test');
    await request('http://local.whistle.com/whistle.test');
    await request('https://local.whistle.com/plugin.test');
    await request('http://local.whistle.com/plugin.test');
    // 如下三个串行
    await request({
        url: 'http://local.whistle.com/cgi-bin/values/add',
        method: 'post',
        form: {
            name: 'test',
            value: '123'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/values/rename',
        method: 'post',
        form: {
            name: 'test',
            newName: '123'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/values/remove',
        method: 'post',
        form: {
            name: '123'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/values/move-to',
        method: 'post',
        form: {
            to: 'test',
            from: 'abc'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/add',
        method: 'post',
        form: {
            name: 'test',
            value: '/test/ file://xxx'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/enable-default',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/remove',
        method: 'post',
        form: {
            name: 'test',
            value: '/test/ file://xxx'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/rename',
        method: 'post',
        form: {
            name: 'test',
            newName: 'sssss'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/select',
        method: 'post',
        form: {
            name: 'test'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/unselect',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/allow-multiple-choice',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/log/set',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/composer',
        method: 'post',
        form: {
            url: 'http://test.whistlejs.com/'
        }
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/intercept-https-connects',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/hide-https-connects',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/do-not-show-again',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/check-update',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/move-to',
        method: 'post'
    });
    await request({
        url: 'http://local.whistle.com/cgi-bin/rules/get-sys-hosts',
        method: 'post'
    });
});
