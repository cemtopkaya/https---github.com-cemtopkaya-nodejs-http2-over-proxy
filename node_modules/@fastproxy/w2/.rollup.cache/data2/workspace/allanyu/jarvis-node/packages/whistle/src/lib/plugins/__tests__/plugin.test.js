import { expect, test } from 'vitest';
import { request } from '../../../__tests__/utils';
test('plugins', async () => {
    const r1 = await request({
        url: 'http://headerreplace.plugin.whistlejs.com:1234/index.html',
        headers: { test: 'abc' }
    });
    expect(r1.data.headers.host).toBe('test.whistlejs.com:1234');
    expect(r1.res.headers['set-cookie'].join()).toBe('abc,abc222');
    const r2 = await request('http://plugin.whistlejs.com:1234/index.html');
    expect(r2.data).toHaveProperty('type', 'server');
    const r3 = await request('wss://321.whistlejs.com/index.html');
    expect(r3.ruleValue).toBe('abc');
    const r4 = await request('wss://321.ws1.whistlejs.com:2222/index.html');
    expect(r4.host).toBe('127.0.0.1:9999');
});
