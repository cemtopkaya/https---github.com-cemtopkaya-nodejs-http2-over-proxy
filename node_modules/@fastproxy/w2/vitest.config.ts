import {defineConfig} from 'vitest/config';

export default defineConfig({
  test: {
    silent: false,
    include: ['./src/**/*.test.ts', './dist/**'],
    exclude: ['**/node_modules/**', './playground/**/*.*', './playground-temp/**/*.*'],
    testTimeout: 10000,
    // 只能依赖setup.js, 因为whistle里面通过cp.spawn启动了子进程, 在vitest或者esm文件的情况下是无效的
    globalSetup: ['./dist/__tests__/setup.js'],
    snapshotFormat: {
      printBasicPrototype: true
    },
    onConsoleLog: (log, type) => {
      if (type === 'stderr' && ['Deprecation warning:', ' Buffer() is deprecated'].some(item => log.includes(item)))
        return false;
      return;
    },
    // singleThread: true,
    threads: false
  },
  esbuild: {
    target: 'node16'
  },
  resolve: {}
});
