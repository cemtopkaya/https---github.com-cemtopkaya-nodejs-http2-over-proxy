"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getMaxSemiSpaceFlag = exports.getVersion = exports.setSudoGid = exports.parseJSON = void 0;
const tslib_1 = require("tslib");
const child_process_1 = tslib_1.__importDefault(require("child_process"));
const parseJSON = function parseJSON(data, decode) {
    if (data) {
        try {
            data = JSON.parse(decode ? decodeURIComponent(data) : data);
        }
        catch (e) {
            data = null;
        }
    }
    return data || {};
};
exports.parseJSON = parseJSON;
const setSudoGid = function setSudoGid() {
    if (process.setgid && process.getgid) {
        process.umask('002');
        process.setgid(parseInt(`${process.env.SUDO_GID || process.getgid()}`, 10));
    }
};
exports.setSudoGid = setSudoGid;
const getVersion = function getVersion(execPath) {
    if (!execPath) {
        return process.version;
    }
    if (typeof child_process_1.default.spawnSync === 'function') {
        try {
            if (/v\d+\.\d+\.\d+/.test(String(child_process_1.default.spawnSync(execPath, ['-v']).output))) {
                return RegExp['$&'];
            }
        }
        catch (e) { }
    }
    return '';
};
exports.getVersion = getVersion;
const getMaxSemiSpaceFlag = function getMaxSemiSpaceFlag(version) {
    const major = parseInt(version.substring(1, version.indexOf('.')), 10);
    if (major < 6) {
        return;
    }
    return major > 9 ? '--max-semi-space-size' : '--max_semi_space_size';
};
exports.getMaxSemiSpaceFlag = getMaxSemiSpaceFlag;
